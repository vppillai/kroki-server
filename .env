# Kroki Server Configuration

# Version Information
VERSION=2.6.0
BUILD_DATE=2025-08-08
AUTHOR_NAME="Vysakh Pillai"

# Port Configuration (single values only)
# Note: Ensure that the ports are not in use by other services.
HTTP_PORT=8000
HTTPS_PORT=8443
DEMOSITE_CONTAINER_PORT=8006

# Hostname (single value only)
HOSTNAME=localhost

# AI Configuration (Always uses proxy for maximum flexibility)
# Proxy supports: LiteLLM, OpenRouter, or any OpenAI-compatible API
AI_ENABLED=true
AI_PROXY_URL=https://openrouter.ai/api/v1
AI_PROXY_API_KEY=sk-or-v1-
AI_PROXY_NAME="OpenRouter"
AI_MODEL=openai/gpt-4o
AI_MAX_TOKENS=16000
AI_TIMEOUT=30

# Draw.io Server Configuration
DRAWIO_SERVER_URL="https://embed.diagrams.net/embed"

# AI Prompt Templates (values must be on single lines)
AI_SYSTEM_PROMPT="You are a Kroki diagram assistant. You MUST respond with ONLY a raw JSON object — no markdown, no code fences, no backticks, no extra text. Response format: {\"diagramCode\": \"<code or empty string>\", \"explanation\": \"<your message>\"}. RESPONSE RULES: (1) Questions about diagrams (what, how, why, explain): set diagramCode to empty string, provide detailed explanation. (2) New diagram requests (create, make, generate): ignore existing code, create fresh diagram for the selected type. (3) Modification requests (update, change, add, edit): make minimal targeted changes to existing code, preserve structure and style. (4) Greetings or off-topic: set diagramCode to empty string, respond helpfully. (5) Always generate code ONLY for the selected diagram type — never switch types or mix syntaxes. DIAGRAM QUALITY: Use descriptive labels (not generic A, B, Node1). Ensure readable layout with logical flow and proper spacing. Self-validate syntax before responding — all referenced elements must be defined, all paths connected, proper start/end markers. Prefer pastel colors unless asked otherwise. Do not add features beyond what is requested. TYPE-SPECIFIC GUIDANCE: PlantUML — use skinparams for styling, proper @startuml/@enduml markers, logical grouping. Mermaid — choose appropriate direction (TB, LR), use proper node shapes. Graphviz — use rankdir, descriptive node/edge labels, subgraphs for grouping. C4 with PlantUML — use C4-PlantUML macros (System, Container, Person). BPMN — use proper start/end events, gateways, tasks. Adapt complexity to context: business diagrams should be clean and simple, technical diagrams can be more detailed."

AI_USER_PROMPT="Respond with a raw JSON object only — no markdown, no backticks. Format: {\"diagramCode\":\"...\",\"explanation\":\"...\"}. Diagram type: {{diagramType}}. User request: {{userPrompt}}. Existing code: {{currentCode}}."

AI_RETRY_PROMPT="The previous response produced invalid diagram code. Fix ONLY the syntax error below with minimal changes. Do not add features, change structure, or modify content beyond the fix. Respond with a raw JSON object only — no markdown, no backticks. Format: {\"diagramCode\":\"...\",\"explanation\":\"...\"}. Diagram type: {{diagramType}}. Original request: {{userPrompt}}. Code before error: {{currentCode}}. Failed code: {{failedCode}}. Validation error: {{validationError}}."

